#!/bin/bash
# Generate a git commit message from staged changes.
# Usage:
#   commit-msg
#   git commit -m "$(commit-msg)"

set -euo pipefail

MODEL="${LLM_MODEL:-claude-3-5-haiku-latest}"

if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "Not in a git repository" >&2
    exit 1
fi

DIFF="$(git diff --staged)"

if [ -z "$DIFF" ]; then
    echo "No staged changes. Stage files first with: git add <files>" >&2
    exit 1
fi

echo "$DIFF" | llm -m "$MODEL" \
    "Write one git commit message subject line for this diff. \
50 characters max. Imperative mood. Output only the message, no quotes, \
no explanation, no trailing punctuation."
